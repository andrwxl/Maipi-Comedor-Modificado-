(function(){var a,b,c,d,e={}.hasOwnProperty,f=[].slice;a={LF:"\n",NULL:"\0"},c=function(){function c(a,b,c){this.command=a,this.headers=null!=b?b:{},this.body=null!=c?c:""}var b;return c.prototype.toString=function(){var b,d,f,g;b=[this.command],g=this.headers;for(d in g)e.call(g,d)&&(f=g[d],b.push(""+d+":"+f));return this.body&&b.push("content-length:"+c.sizeOfUTF8(this.body)),b.push(a.LF+this.body),b.join(a.LF)},c.sizeOfUTF8=function(a){return a?encodeURI(a).split(/%..|./).length-1:0},b=function(b){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(g=b.search(RegExp(""+a.LF+a.LF)),h=b.substring(0,g).split(a.LF),f=h.shift(),i={},o=function(a){return a.replace(/^\s+|\s+$/g,"")},s=h.reverse(),p=0,r=s.length;p<r;p++)m=s[p],k=m.indexOf(":"),i[o(m.substring(0,k))]=o(m.substring(k+1));if(d="",n=g+2,i["content-length"])l=parseInt(i["content-length"]),d=(""+b).substring(n,n+l);else for(e=null,j=q=n,t=b.length;(n<=t?q<t:q>t)&&(e=b.charAt(j),e!==a.NULL);j=n<=t?++q:--q)d+=e;return new c(f,i,d)},c.unmarshall=function(c){var d;return function(){var e,f,g,h;for(g=c.split(RegExp(""+a.NULL+a.LF+"*")),h=[],e=0,f=g.length;e<f;e++)d=g[e],(null!=d?d.length:void 0)>0&&h.push(b(d));return h}()},c.marshall=function(b,d,e){var f;return f=new c(b,d,e),f.toString()+a.NULL},c}(),b=function(){function e(a){this.ws=a,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var b;return e.prototype.debug=function(a){var b;return"undefined"!=typeof window&&null!==window&&null!=(b=window.console)?b.log(a):void 0},b=function(){return Date.now||(new Date).valueOf},e.prototype._transmit=function(a,b,d){var e;for(e=c.marshall(a,b,d),"function"==typeof this.debug&&this.debug(">>> "+e);;){if(!(e.length>this.maxWebSocketFrameSize))return this.ws.send(e);this.ws.send(e.substring(0,this.maxWebSocketFrameSize)),e=e.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+e.length)}},e.prototype._setupHeartbeat=function(c){var e,f,g,h,i,j;if((i=c.version)===d.VERSIONS.V1_1||i===d.VERSIONS.V1_2)return j=function(){var a,b,d,e;for(d=c["heart-beat"].split(","),e=[],a=0,b=d.length;a<b;a++)h=d[a],e.push(parseInt(h));return e}(),f=j[0],e=j[1],0!==this.heartbeat.outgoing&&0!==e&&(g=Math.max(this.heartbeat.outgoing,e),"function"==typeof this.debug&&this.debug("send PING every "+g+"ms"),this.pinger=d.setInterval(g,function(b){return function(){return b.ws.send(a.LF),"function"==typeof b.debug?b.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==f?(g=Math.max(this.heartbeat.incoming,f),"function"==typeof this.debug&&this.debug("check PONG every "+g+"ms"),this.ponger=d.setInterval(g,function(a){return function(){var c;if(c=b()-a.serverActivity,c>2*g)return"function"==typeof a.debug&&a.debug("did not receive server activity for the last "+c+"ms"),a.ws.close()}}(this))):void 0},e.prototype._parseConnect=function(){var a,b,c,d;switch(a=1<=arguments.length?f.call(arguments,0):[],d={},a.length){case 2:d=a[0],b=a[1];break;case 3:a[1]instanceof Function?(d=a[0],b=a[1],c=a[2]):(d.login=a[0],d.passcode=a[1],b=a[2]);break;case 4:d.login=a[0],d.passcode=a[1],b=a[2],c=a[3];break;default:d.login=a[0],d.passcode=a[1],b=a[2],c=a[3],d.host=a[4]}return[d,b,c]},e.prototype.connect=function(){var e,g,h,i;return e=1<=arguments.length?f.call(arguments,0):[],i=this._parseConnect.apply(this,e),h=i[0],this.connectCallback=i[1],g=i[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(d){return function(e){var f,h,i,j,k,l,m,n,o,p,q,r;if(j="undefined"!=typeof ArrayBuffer&&e.data instanceof ArrayBuffer?(f=new Uint8Array(e.data),"function"==typeof d.debug?d.debug("--- got data length: "+f.length):void 0,function(){var a,b,c;for(c=[],a=0,b=f.length;a<b;a++)h=f[a],c.push(String.fromCharCode(h));return c}().join("")):e.data,d.serverActivity=b(),j===a.LF)return void("function"==typeof d.debug&&d.debug("<<< PONG"));for("function"==typeof d.debug&&d.debug("<<< "+j),q=c.unmarshall(j),r=[],o=0,p=q.length;o<p;o++)switch(k=q[o],k.command){case"CONNECTED":"function"==typeof d.debug&&d.debug("connected to server "+k.headers.server),d.connected=!0,d._setupHeartbeat(k.headers),r.push("function"==typeof d.connectCallback?d.connectCallback(k):void 0);break;case"MESSAGE":n=k.headers.subscription,m=d.subscriptions[n]||d.onreceive,m?(i=d,l=k.headers["message-id"],k.ack=function(a){return null==a&&(a={}),i.ack(l,n,a)},k.nack=function(a){return null==a&&(a={}),i.nack(l,n,a)},r.push(m(k))):r.push("function"==typeof d.debug?d.debug("Unhandled received MESSAGE: "+k):void 0);break;case"RECEIPT":r.push("function"==typeof d.onreceipt?d.onreceipt(k):void 0);break;case"ERROR":r.push("function"==typeof g?g(k):void 0);break;default:r.push("function"==typeof d.debug?d.debug("Unhandled frame: "+k):void 0)}return r}}(this),this.ws.onclose=function(a){return function(){var b;return b="Whoops! Lost connection to "+a.ws.url,"function"==typeof a.debug&&a.debug(b),a._cleanUp(),"function"==typeof g?g(b):void 0}}(this),this.ws.onopen=function(a){return function(){return"function"==typeof a.debug&&a.debug("Web Socket Opened..."),h["accept-version"]=d.VERSIONS.supportedVersions(),h["heart-beat"]=[a.heartbeat.outgoing,a.heartbeat.incoming].join(","),a._transmit("CONNECT",h)}}(this)},e.prototype.disconnect=function(a){return this._transmit("DISCONNECT"),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof a?a():void 0},e.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&d.clearInterval(this.pinger),this.ponger)return d.clearInterval(this.ponger)},e.prototype.send=function(a,b,c){return null==b&&(b={}),null==c&&(c=""),b.destination=a,this._transmit("SEND",b,c)},e.prototype.subscribe=function(a,b,c){var d;return null==c&&(c={}),c.id||(c.id="sub-"+this.counter++),c.destination=a,this.subscriptions[c.id]=b,this._transmit("SUBSCRIBE",c),d=this,{id:c.id,unsubscribe:function(){return d.unsubscribe(c.id)}}},e.prototype.unsubscribe=function(a){return delete this.subscriptions[a],this._transmit("UNSUBSCRIBE",{id:a})},e.prototype.begin=function(a){var b,c;return c=a||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:c}),b=this,{id:c,commit:function(){return b.commit(c)},abort:function(){return b.abort(c)}}},e.prototype.commit=function(a){return this._transmit("COMMIT",{transaction:a})},e.prototype.abort=function(a){return this._transmit("ABORT",{transaction:a})},e.prototype.ack=function(a,b,c){return null==c&&(c={}),c["message-id"]=a,c.subscription=b,this._transmit("ACK",c)},e.prototype.nack=function(a,b,c){return null==c&&(c={}),c["message-id"]=a,c.subscription=b,this._transmit("NACK",c)},e}(),d={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(a,c){var e,f;return null==c&&(c=["v10.stomp","v11.stomp"]),e=d.WebSocketClass||WebSocket,f=new e(a,c),new b(f)},over:function(a){return new b(a)},Frame:c},"undefined"!=typeof window&&null!==window?(d.setInterval=function(a,b){return window.setInterval(b,a)},d.clearInterval=function(a){return window.clearInterval(a)},window.Stomp=d):"undefined"!=typeof exports&&null!==exports?exports.Stomp=d:self.Stomp=d}).call(this);